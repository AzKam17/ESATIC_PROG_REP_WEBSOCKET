(self.webpackChunk=self.webpackChunk||[]).push([[143],{7670:(t,e,n)=>{var o={"./hello_controller.js":6926};function i(t){var e=s(t);return n(e)}function s(t){if(!n.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}i.keys=function(){return Object.keys(o)},i.resolve=s,t.exports=i,i.id=7670},8205:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>o});const o={}},6926:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>h});n(8304),n(489),n(1539),n(2419),n(8011),n(9070),n(2526),n(1817),n(2165),n(6992),n(8783),n(3948);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=u(t);if(e){var i=u(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return c(this,n)}}function c(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}var h=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}(u,t);var e,n,o,c=a(u);function u(){return i(this,u),c.apply(this,arguments)}return e=u,(n=[{key:"connect",value:function(){this.element.textContent="Hello Stimulus! Edit me in assets/controllers/hello_controller.js"}}])&&s(e.prototype,n),o&&s(e,o),u}(n(7931).Controller)},453:(t,e,n)=>{"use strict";n(9070),n(9600),n(4916),n(3123),n(2564),n(2222),n(1249),n(2707),n(8309),n(4812),(0,n(2192).x)(n(7670)),n(8871);var o=n(9755),i=new fabric.Canvas("myCanvas");o(".pen-range").val(1);var s=function(){};function r(){var t="black";i.backgroundColor="white",o("#Clear").click((function(){i.clear()})),o(".color").click((function(){t=o(this).attr("id"),i.freeDrawingBrush.color=t})),o(".pen-range").change((function(){i.freeDrawingBrush.width=o(this).val()})),i.observe("mouse:down",(function(t){var e=i.getPointer(t.e);e.x,e.y,i.isDrawingMode=!0})),i.observe("mouse:up",(function(){0,s()}))}function a(){return function(){var t=o(".container"),e=o(".wrapper"),n=o(".canvas-container");o("canvas");e.css("height","100%"),e.css("width",t.outerWidth(!1)),e.css("height",e.height()-t.height()),e.css("margin-left",t.css("margin-left")),n.css("width","100%"),n.css("height","100%"),i.setWidth(n.width()),i.setHeight(n.height()),i.calcOffset()}}o(document).ready((function(){!function(){var t,e={pseudo:!1,lobby:!1,room:!1},n={},c=null!==(t=sessionStorage.getItem("pseudo"))&&void 0!==t?t:"",u=null;o("#pseudo").hide(),o("#lobby").hide(),setTimeout((function(){o("#room").hide()}),500);var h=function(){var t=o("#pseudoInput").val();""!==t&&void 0!==t&&t.length>3&&(sessionStorage.setItem("pseudo",t),B("lobby",!0))};o("#validerPseudo").click((function(){h()})),o("#pseudoInput").keydown((function(t){if("Enter"===t.code)h();else{var e="#pseudoInput",n=o(e).val(),i=""!==n&&void 0!==n&&n.length>3,s=i?"is-valid":"is-invalid",r=i?"is-invalid":"is-valid";o(e).addClass(s).removeClass(r)}}));var l=function(){c=sessionStorage.getItem("pseudo"),o("#msgLobbyWelcome").text("Bienvenue "+c)},d=function(t){o("#nbRoomsDispo").text("".concat(t.length," salle").concat(C(t.length)," disponible").concat(C(t.length),".")),o("#tableChoixRoom").text(""),t.map((function(t,e){var i=o("<tr/>").addClass("table-light").append(o("<th/>").addClass("row pb-3 pt-3").text(t.lib)).append(o("<td/>").append(o("<button/>").text("Rejoindre").attr("type","button").addClass("btn btn-primary btn-sm room-btn").click((function(){f(t.lib.removeSpaces+"#"+t.id)}))));o("#tableChoixRoom").append(i),void 0===n[t.lib.removeSpaces+"#"+t.id]&&(n[t.lib.removeSpaces+"#"+t.id]={lib:t.lib,paint:null,messages:[]},g(t.id))}))},f=function(t){B("room",!0,(function(){u=t,o("#roomName").text("".concat(n[t].lib));try{r(),a()(),o(window).resize((function(){a()()}))}catch(t){console.log("Canvas Err")}})),k(!0)};o("#returnLobby").click((function(){p()})),o("#roomMessageSendBtn").click((function(){m()})),o("#roomInput").keydown((function(t){"Enter"===t.code&&m()}));var p=function(){u=null,i.clear(),y.send(JSON.stringify({id:null,sender:"Salia",content:"Hello",type:"init",troom:null,room:null})),B("lobby",!0)},y=new WebSocket("wss://".concat(location.hostname,":3000"));y.addEventListener("open",(function(){console.log("Connexion réussie au serveur WebSocket"),setTimeout((function(){y.send(JSON.stringify({id:null,sender:"Salia",content:"Hello",type:"init",troom:"",room:null}))}),500)})),y.addEventListener("close",(function(){console.log("La connexion au serveur WebSocket a été perdue")})),y.addEventListener("error",(function(){console.log("Une erreur a eu lieu lors de la communication avec le serveur Websocket")})),y.addEventListener("message",(function(t){v(t.data)}));var v=function(t){try{var e=JSON.parse(t);switch(e[0].type){case"init":d(e);break;case"msg":for(var o=0;o<e.length;o++)w(e[o].code,e[o]);k();break;case"canvas":n[e[0].code].paint=e[0].content,k(!0)}}catch(t){}},b=function(t){var e="";e=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?{sender:c,content:t.content,type:t.type,room:null,code:""}:{sender:c,content:t.content,type:t.type,room:null,code:u.split("#")[1]},y.send(JSON.stringify(e))},m=function(){var t="#roomInput";o(t).val().length>0&&(b({content:o(t).val(),type:"msg"}),s(),o(t).val(""))},g=function(t){b({content:t,type:"getRoomMessages"},!0)},w=function(t,e){n[t].messages.push(e)},k=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null!=u){n[u].messages.sort((function(t,e){return t.id-e.id||t.name.localeCompare(e.name)}));var e=null;o("#chatBox").html("");for(var s=0;s<n[u].messages.length;s++)e=n[u].messages[s],o("#chatBox").append("".concat(s>0?"<br>":"","[<b>").concat(e.sender,"</b>] ").concat(e.content));o("#chatBox").scrollTop((function(){return this.scrollHeight})),t&&(i.clear(),i.loadFromJSON(n[u].paint,i.renderAll.bind(i)))}};s=function(){n[u].paint=JSON.stringify(i),b({content:JSON.stringify(i),type:"canvas"})},o("#clearCanvas").click((function(){i.clear(),s(),b({content:" - <i><b>A nettoyé le tableau</b></i>",type:"msg"})}));var C=function(t){return t>1?"s":""},B=function(t,n,i){if(e[t]=n,"lobby"===t)l();for(var s in e)if(""!==s&&void 0!==s){s!==t&&(e[s]=!1);var r="#"+s;e[s]?o(r).show():o(r).hide()}return i instanceof Function&&i(),!0};B(""===c||void 0===c?"pseudo":"lobby",!0)}(),Object.defineProperty(String.prototype,"removeSpaces",{get:function(){return this.toLowerCase().split(" ").join("")}}),r(),a()(),o(window).resize((function(){a()()}))}))},8871:function(t,e,n){var o;n(4916),o=function(){function t(t){this.tokensize=t||10,this.reset(!0)}return t.prototype.reset=function(t){!0===t&&(this.nodes=[{up:0,weight:0}],this.nyt=0,this.nodecount=0),this.data="",this.curpos=0,this.bitCount=7,this.bitChar=0},t.prototype.findNode=function(t){for(var e=this.nodes.length-1;e>0;e--)if(void 0!==this.nodes[e].symbol&&this.nodes[e].symbol==t)return e;return 0},t.prototype.addNode=function(t){return this.nodecount>=2046?0:(this.nodes[++this.nodecount]={up:this.nyt,symbol:t,weight:1},this.nodes[++this.nodecount]={up:this.nyt,weight:0},this.nodes[this.nyt].weight+=1,this.nyt=this.nodecount,this.nodes[this.nodecount-2].up!=this.nodecount-2&&this.balanceNode(this.nodes[this.nodecount-2].up),this.nodecount-2)},t.prototype.swapNode=function(t,e){var n=this.nodes[t].symbol,o=this.nodes[e].symbol,i=this.nodes[t].weight;this.nodes[t].symbol=o,this.nodes[e].symbol=n,this.nodes[t].weight=this.nodes[e].weight,this.nodes[e].weight=i;for(var s=this.nodes.length-1;s>0;s--)this.nodes[s].up==t?this.nodes[s].up=e:this.nodes[s].up==e&&(this.nodes[s].up=t)},t.prototype.balanceNode=function(t){for(;;){for(var e=t,n=this.nodes[t].weight;e>1&&this.nodes[e-1].weight==n;)e--;if(e!=t&&e!=this.nodes[t].up&&(this.swapNode(e,t),t=e),this.nodes[t].weight++,this.nodes[t].up==t)return;t=this.nodes[t].up}},t.prototype.emitNode=function(t){for(var e=[];0!=t;)e.unshift(t%2),t=this.nodes[t].up;for(var n=0;n<e.length;n++)this.emitBit(e[n])},t.prototype.emitNyt=function(t){this.emitNode(this.nyt);var e=t.length-1;this.tokensize>8&&this.emitBit(8&e),this.tokensize>4&&this.emitBit(4&e),this.tokensize>2&&this.emitBit(2&e),this.tokensize>1&&this.emitBit(1&e);for(var n=0;n<t.length;n++)this.emitByte(t.charCodeAt(n));return this.nyt},t.prototype.readNode=function(){if(0==this.nyt){for(var t=(this.tokensize>8?8*this.readBit():0)+(this.tokensize>4?4*this.readBit():0)+(this.tokensize>2?2*this.readBit():0)+(this.tokensize>1?this.readBit():0)+1,e="";t--;)e+=this.readByte();return e}for(var n=0;;){var o=this.readBit();if(null==this.nodes[n].symbol)for(var i=0;;i++)if(this.nodes[i].up==n&&i!=n&&i%2==o){n=i;break}if(null!=this.nodes[n].symbol||0==this.nodes[n].weight){if(this.nodes[n].weight)return this.nodes[n].symbol;for(t=(this.tokensize>8?8*this.readBit():0)+(this.tokensize>4?4*this.readBit():0)+(this.tokensize>2?2*this.readBit():0)+(this.tokensize>1?this.readBit():0)+1,e="";t--;)e+=this.readByte();return e}}},t.prototype.emitBit=function(t){t&&(this.bitChar+=1<<this.bitCount),--this.bitCount<0&&(this.data+=String.fromCharCode(this.bitChar),this.bitCount=7,this.bitChar=0)},t.prototype.emitByte=function(t){for(var e=7;e>=0;e--)this.emitBit(t>>e&1)},t.prototype.readBit=function(){if(this.curpos==8*this.data.length)throw"done";var t=this.data.charCodeAt(this.curpos>>3)>>(7-this.curpos&7)&1;return this.curpos++,t},t.prototype.readByte=function(){res=0;for(var t=0;8>t;t++)res+=(128>>t)*this.readBit();return String.fromCharCode(res)},t.prototype.deflate=function(t){var e,n,o,i=t.length;for(this.reset(),n=0;i>n;n++){if(e=t[n],this.tokensize>1)if(/[a-zA-Z]/.test(e))for(;i>n+1&&e.length<this.tokensize&&/[a-zA-Z]/.test(t[n+1]);)e+=t[++n];else if(/[=\[\],\.:\"'\{\}]/.test(e))for(;i>n+1&&e.length<this.tokensize&&/[=\[\],\.:\"'\{\}]/.test(t[n+1]);)e+=t[++n];(o=this.findNode(e))?(this.emitNode(o),this.balanceNode(o)):(this.emitNyt(e),o=this.addNode(e))}if(7!=this.bitCount){var s=this.data.length;this.emitNode(this.nyt),s==this.data.length&&this.emitByte(0)}return this.data},t.prototype.inflate=function(t){this.reset(),this.data=t;var e="";try{for(var n=0;n>=0;n++){var o=this.readNode();e+=o;var i=this.findNode(o);i?this.balanceNode(i):this.addNode(o)}}catch(t){}return e},t},t.exports?t.exports=o():n.amdD("Shorty",o)}},t=>{t.O(0,[507],(()=>{return e=453,t(t.s=e);var e}));t.O()}]);